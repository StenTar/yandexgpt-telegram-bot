# yandexgpt_marketer.py
import requests

class YandexGPTMarketerDetailedCoT:
    def __init__(self, api_key, folder_id):
        self.api_key = api_key
        self.folder_id = folder_id
        self.url = "https://llm.api.cloud.yandex.net/foundationModels/v1/completion"

    def create_product_card(self, user_input):
        headers = {
            "Authorization": f"Api-Key {self.api_key}",
            "Content-Type": "application/json"
        }

        system_prompt = """
        –¢—ã - –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç-—Ä–µ–¥–∞–∫—Ç–æ—Ä –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ (Ozon/Wildberries).
        –ó–∞–¥–∞—á–∞: —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

        –¢–í–û–ô –ü–†–û–¶–ï–°–° –†–ê–ë–û–¢–´:

        –®–ê–ì 1: –ê–ù–ê–õ–ò–ó –ò –†–ê–°–°–£–ñ–î–ï–ù–ò–Ø
        –ü—Ä–æ–≤–µ–¥–∏ –∞–Ω–∞–ª–∏–∑ –ø–æ —ç—Ç–æ–π –ª–æ–≥–∏–∫–µ –∏ –ø–æ–∫–∞–∂–∏ –µ–≥–æ –ø–µ—Ä–µ–¥ –∫–∞—Ä—Ç–æ—á–∫–æ–π —Ç–æ–≤–∞—Ä–∞:

        üîç **–õ–û–ì–ò–ö–ê –†–ê–°–°–£–ñ–î–ï–ù–ò–ô:**
        1) –ö–ê–¢–ï–ì–û–†–ò–Ø —Ç–æ–≤–∞—Ä–∞: [–æ–¥–Ω–æ —Å–ª–æ–≤–æ]
        2) –¶–ï–õ–ï–í–ê–Ø –ê–£–î–ò–¢–û–†–ò–Ø: [–∫—Ç–æ –±—É–¥–µ—Ç –ø–æ–∫—É–ø–∞—Ç—å]
        3) 3 –ì–õ–ê–í–ù–´–ï –í–´–ì–û–î–´:
           - [–≤—ã–≥–æ–¥–∞ 1]
           - [–≤—ã–≥–æ–¥–∞ 2]
           - [–≤—ã–≥–æ–¥–∞ 3]
        4) –ö–õ–Æ–ß–ï–í–´–ï –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò:
           - [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ 1]
           - [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ 2]
           - [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ 3]
           - [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ 4]
        5) –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–ï–õ–´: [—á—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –Ω–æ –≤–∞–∂–Ω–æ]

        –®–ê–ì 2: –°–û–ó–î–ê–ù–ò–ï –ö–ê–†–¢–û–ß–ö–ò –¢–û–í–ê–†–ê
        –ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–∑–¥–∞–π –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

        üîπ **–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:**
        [–Ω–∞–∑–≤–∞–Ω–∏–µ]

        üîπ **–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:**
        [1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è]

        üîπ **–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:**
        [5-7 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π]

        üîπ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
        - [–ø—É–Ω–∫—Ç 1]
        - [–ø—É–Ω–∫—Ç 2]
        - [–ø—É–Ω–∫—Ç 3]
        - [–ø—É–Ω–∫—Ç 4]

        üîπ **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
        - [–ø–∞—Ä–∞–º–µ—Ç—Ä: –∑–Ω–∞—á–µ–Ω–∏–µ]
        - [–ø–∞—Ä–∞–º–µ—Ç—Ä: –∑–Ω–∞—á–µ–Ω–∏–µ]
        - [–ø–∞—Ä–∞–º–µ—Ç—Ä: –∑–Ω–∞—á–µ–Ω–∏–µ]
        - [–ø–∞—Ä–∞–º–µ—Ç—Ä: –∑–Ω–∞—á–µ–Ω–∏–µ]

        üîπ **SEO-–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:**
        [—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é]

        –ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–º–æ—Ç—Ä–∏ –≤—ã—à–µ.
        """

        data = {
            "modelUri": f"gpt://{self.folder_id}/yandexgpt-lite",
            "completionOptions": {
                "stream": False,
                "temperature": 0.2,
                "maxTokens": 3000
            },
            "messages": [
                {"role": "system", "text": system_prompt},
                {"role": "user", "text": f"–°–æ–∑–¥–∞–π –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ –¥–ª—è: {user_input}"}
            ]
        }

        try:
            response = requests.post(self.url, headers=headers, json=data)
            if response.status_code == 200:
                return response.json()["result"]["alternatives"][0]["message"]["text"]
            else:
                return f"‚ùå –û—à–∏–±–∫–∞ YandexGPT: {response.status_code}"
        except Exception as e:
            return f"‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: {str(e)}"
